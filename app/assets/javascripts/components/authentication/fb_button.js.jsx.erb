var FBButton = React.createClass({
  mixins: [ReactRouter.History],

  getInitialState: function () {
    return {};
  },

  fbauth: function(response) {
    // console.log(response)
      if (response.authResponse) {
        this.fbLogin(response);
      } else {
        this.fbLogout(response);
      }
  },

  componentDidMount: function(){
      window.FB.XFBML.parse()
      window.FB.Event.subscribe('auth.statusChange', this.fbauth);
  },

  fbLogin: function (response) {
    SessionApiUtil.fblogin(response.authResponse, this.success, this.error);
  },

  fbLogout: function () {
    SessionApiUtil.fblogout(this.success, this.error);
  },

  success: function () {
    FB.api('/me?fields=name,email',
     function(response) {
      console.log(JSON.stringify(response));
    });
    this.history.pushState(null, "/home");
  },

  componentWillUnmount: function() {
    window.FB.Event.unsubscribe('auth.statusChange', this.fbauth);
  },

  render: function () {
    return (
      <div className="third-party-auth">
        <div
          className="fb-login-button"
          data-width="50"
          data-max-rows="1"
          data-size="small"
          data-button-type="login_with"
          data-show-faces="false"
          data-auto-logout-link="true"
          data-scope="email,public_profile"
          data-use-continue-as="false">
        </div>
      </div>
    );
  }
});
